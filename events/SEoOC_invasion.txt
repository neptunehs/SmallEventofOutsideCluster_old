namespace = nep_inva

#Create cluster,portal
country_event = {
	id = nep_inva.1
	title = "nep_inva.1.name"
	desc = "nep_inva.1.desc"	
	picture = GFX_evt_drifting_gateway

	fire_only_once = yes

	trigger = {
		is_ai = no
		has_global_flag = nep_dragon_end
		has_country_flag = nep_dragon_summoner
	}

	mean_time_to_happen = {
		days = 360
	}

	immediate = {
		#cluster
		set_spawn_system_batch = begin
		no_scope = {
			spawn_system = {
				min_distance >= 565
				max_distance <= 575
				min_orientation_angle = 314
				max_orientation_angle = 316
				hyperlane = no
				initializer = nep_Central_init
			}
		}
		random_system = { 
			limit = { has_star_flag = nep_Central_system }
			spawn_system = {
				min_distance >= 15
				max_distance <= 35
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Centaury_init
			}
			spawn_system = {
				min_distance >= 15
				max_distance <= 35
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Magellan_init
			}
			spawn_system = {
				min_distance >= 15
				max_distance <= 35
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Orion_init
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 40
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Tra_init
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 40
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Aurora_init
			}
			spawn_system = {
				min_distance >= 15
				max_distance <= 35
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Andromeda_init
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 40
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Persei_init
			}
			spawn_system = {
				min_distance >= 20
				max_distance <= 40
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Trantor_init
			}
			spawn_system = {
				min_distance >= 30
				max_distance <= 50
				min_orientation_angle = 0
				max_orientation_angle = 360
				hyperlane = no
				initializer = nep_Exterior_init
			}
		}
		while = {
			limit = {
				any_system = {
					has_star_flag = nep_Krahen_cluster
					check_variable = { which = hyperlane_num value < 3 }
				}
			}
			random_system = {
				limit = {
					has_star_flag = nep_Krahen_cluster
					check_variable = { which = hyperlane_num value < 3 }
				}
				random_system = {
					limit = {
						NOT = { 
							is_same_value = prev 
							has_hyperlane_to = prev
						}
						has_star_flag = nep_Krahen_cluster
						check_variable = { which = hyperlane_num value < 3 }
					}
					add_hyperlane = {
						from = this
						to = prev
					}
					change_variable = { which = hyperlane_num value = 1 }
				}
				change_variable = { which = hyperlane_num value = 1 }
			}
		}
		set_spawn_system_batch = end
		random_planet = {
			limit = {
				has_planet_flag = nep_seal_2
			}
			spawn_megastructure = {
				#name = ""
				type = nep_sealgate_ruined
				orbit_angle = 1
				orbit_distance = 1
			}
		}
	}
}

#Create krahen,on_system_first_visited
country_event = {
	id = nep_inva.2
	title = "nep_inva.2.name"
	desc = "nep_inva.2.desc"	
	picture = GFX_evt_fleet_evil

	fire_only_once = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		FROM = { has_star_flag = nep_Krahen_cluster }
		NOT = { has_global_flag = nep_karhen_begin }
	}
	
	immediate = {
		create_species = {
			name = Krah'en
			class = random_non_machine
			portrait = random
			traits = trait_krahen
		}
		create_country = {
			name = "Krah'en Empire"
			species = last_created
			type = nep_krahen_country
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_10.dds"
				}
				background= {
					category = "backgrounds"
					file = "new_dawn.dds"
				}
				colors={
					"red"
					"black"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			set_country_flag = nep_krahen_country
			save_global_event_target_as = nep_krahen_country
		}
		set_global_flag = nep_karhen_begin
		create_krahen_invader_defender = yes
	}
}

#Krah'en crisis begin (HIDDEN)
country_event = {
	id = nep_inva.30
	hide_window = yes
	
	trigger = {
		has_global_flag = nep_karhen_begin
		any_country = {
			has_country_flag = nep_krahen_country
			num_fleets < 1
		}
	}
	
	mean_time_to_happen = {
		days = 5
	}
	
	immediate = {
		set_global_flag = nep_krahen_crisis
		#create krahen colony&invader force
		every_system = {
			limit = { 
				has_star_flag = nep_Krahen_cluster
				NOT = { any_ship_in_system = { owner = has_country_flag = nep_krahen_country } }
			}
			create_starbase = {
				size = nep_heavy_starbase
				owner = event_target:nep_krahen_country
			}
			if = {
				limit = { NOT = { has_star_flag = nep_Exterior_star } }
				random_system_planet = {
					limit = {
						is_colony = no
					}
					create_colony = {
						owner = event_target:nep_krahen_country
						species = event_target:nep_krahen_country
						ethos = owner
					}
				}
				random_system_planet = {
					limit = {
						is_colony = no
					}
					create_colony = {
						owner = event_target:nep_krahen_country
						species = event_target:nep_krahen_country
						ethos = owner
					}
					create_krahen_buildings = yes
					create_krahen_invader = yes
					create_krahen_invader = yes
				}
				random_system_planet = {
					limit = {
						is_colony = no
					}
					create_colony = {
						owner = event_target:nep_krahen_country
						species = event_target:nep_krahen_country
						ethos = owner
					}
					create_krahen_buildings = yes
					create_krahen_invader = yes
					create_krahen_invader = yes
				}
			}
		}
		
		#create krahen portal&defender force
		random_system = {
			limit = { has_star_flag = nep_Central_system }
			random_system_planet = {
				limit = { is_colony = yes }
				create_fleet = {
					name = "NAME_Portal_to_God'Emperor"
					effect = {
						set_owner = event_target:nep_krahen_country
						create_ship = {
							name = "NAME_Portal_to_God'Emperor"
							design = "NAME_nep_krahen_portal"
							prefix = no
							upgradable = no
						}
						set_event_locked = yes
					}
					set_fleet_flag = nep_krahen_portal_1
				}
				
			}
		}
		
		#diplomatic
		every_playable_country = {
			country_event = { id = nep_inva.31 }
		}
	}
}

#Krah'en crisis diplomatic
country_event = {
	id = nep_inva.31
	title = "nep_inva.31.name"
	desc = "nep_inva.31.desc"

	diplomatic = yes
	
	is_triggered_only = yes
		
	picture_event_data = {
		portrait = event_target:nep_krahen_country
		planet_background = event_target:nep_krahen_country
		graphical_culture = event_target:nep_krahen_country
		city_level = event_target:nep_krahen_country
		room = event_target:nep_krahen_country
	}
	
	option = {
		name = nep_inva.31.a
		response_text = nep_inva.3.a.response
		is_dialog_only = yes
	}
	
	option = {
		name = nep_inva.31.b
		response_text = nep_inva.3.b.response
		is_dialog_only = yes
	}
	
	option = {
		name = nep_inva.31.c
	}
}